import os
import json
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('all-MiniLM-L6-v2')


def get_files(filepath):
    file_set = set()
    for base, dirs, files in os.walk(filepath):
        for filename in files:
            file_set.add(base + '/' + filename)
    return file_set


def create_embeddings():
    files = get_files('abstracts_title')
    all_data = []
    file_names = []

    for file in files:
        if os.path.getsize(file) != 0:
            with open(file, 'r') as f:
                content = f.read()
                all_data.append(content)
                file_names.append(file.split('/')[-1].replace('.txt', ''))
        else:
            print("File size is 0")

    sentence_embeddings = model.encode(all_data)
    sentence_embeddings = sentence_embeddings.tolist()
    result = dict(zip(file_names, sentence_embeddings))
    print("writing to a file")
    with open('filter/file_embeddings_sentence_transformer.json', 'w') as f:
        json.dump(result, f)
    print("wrote to a file")

#
# def reading_embeddings(articles):
#     f = open('file_embeddings_sentence_transformer.json')
#     data = json.load(f)
#     # print([data[title.replace('/', '-')] for title in articles])
#    x = [data.key() ]


if __name__ == "__main__":
    create_embeddings()
    #
    # articles = ['Temporal Interpolation of 4D PC-MRI Blood-flow Measurements Using Bidirectional Physics-based Fluid Simulation', 'Polar Space Based Shape Averaging for Star-shaped Biological Objects', 'CT-Based Navigation Guidance for Liver Tumor Ablation', 'Extracting and Visualizing Uncertainties in Segmentations from 3D Medical Data', 'Towards Clinical Deployment of Automated Anatomical Regions-Of-Interest', 'Estimation of the Midsagittal Plane for Sideness Determination of Malignant Structures of Head and Neck', 'Molecular Sombreros: Abstract Visualization of Binding Sites within Proteins', 'Coherence Maps for Blood Flow Exploration', 'Exploration of Interventricular Septum Motion in Multi-Cycle Cardiac MRI', 'Iterative Exploration of Big Brain Network Data', 'Comparative Visualization for Diffusion Tensor Imaging Group Study at Multiple Levels of Detail', 'InkVis: A High-Particle-Count Approach for Visualization of Phase-Contrast Magnetic Resonance Imaging Data', 'Schematic Electrode Map for Navigation in Neuro Data Sets', 'Parametric-based Reconstruction Of 3D Mesh Models; Towards the Generation of a Parametric Human Foot Biomodel', 'Impact of Physical Noise Modeling on Image Segmentation in Echocardiography', 'Visual Exploratory Analysis for Multiple T-Maze Studies', 'Misalignment Correction in Open Cone-Beam CT', 'Maximizing AUC with Deep Learning for Classification of Imbalanced Mammogram Datasets', 'Bone Fracture and Lesion Assessment using Shape-Adaptive Unfolding', 'Unfolding and Interactive Exploration of Protein Tunnels and their Dynamics', 'Watergate: Visual Exploration of Water Trajectories in Protein Dynamics', 'Automatic Segmentation of the Pelvic Bones from CT Data Based on a Statistical Shape Model', 'The iCoCooN: Integration of Cobweb Charts with Parallel Coordinates for Visual Analysis of DCE-MRI Modeling Variations', 'Atomistic Visualization of Mesoscopic Whole-Cell Simulations', 'Adapted Surface Visualization of Cerebral Aneurysms with Embedded Blood Flow Information', 'Staircase-Aware Smoothing of Medical Surface Meshes', 'A Survey of Cardiac 4D PC-MRI Data Processing', 'VisualFlatter - Visual Analysis of Distortions in the Projection of Biomedical Structures', 'Challenges and Technologies for Low Cost Wheelchair Simulation', 'Monte-Carlo Ray-Tracing for Realistic Interactive Ultrasound Simulation', 'Automatic Animations to Analyze Blood Flow Data', 'A Haptics-enabled Simulator for Transperineal Ultrasound-Guided Biopsy', 'Membrane Mapping: Combining Mesoscopic and Molecular Cell Visualization', 'Visual Analysis and Comparison of Multiple Sequence Alignments', 'The Role of Depth Perception in XR from a Neuroscience Perspective: A Primer and Survey', 'Evolutionary Pathlines for Blood Flow Exploration in Cerebral Aneurysms', 'Interactive Multimodal Imaging Visualization for Multiple Sclerosis Lesion Analysis', 'Spatio-temporal Visualization of Regional Myocardial Velocities', 'Chameleon - Dynamic Color Mapping for Multi-Scale Structural Biology Models', 'A Two-Level Cascade Classification Algorithm for Real-Time Bifurcation Detection in CTA Images of Blood Vessels', 'Reducing Model Uncertainty in Crossing Fiber Tractography', 'Volume Visualization Using Principal Component Analysis', 'Pelvis Runner: Visualizing Pelvic Organ Variability in a Cohort of Radiotherapy Patients', 'A Prototype Holographic Augmented Reality Interface for Image-Guided Prostate Cancer Interventions', 'Automatic Cutting and Flattening of Carotid Artery Geometries', 'AR-Assisted Craniotomy Planning for Tumour Resection', 'Computation of More Channels in Protein Molecules', 'Semi-Immersive 3D Sketching of Vascular Structures for Medical Education', 'Aneulysis - A System for Aneurysm Data Analysis', 'PATHONE: From one Thousand Patients to one Cell', 'Visual Analytics in Histopathology Diagnostics: a Protocol-Based Approach', 'Annotated Dendrograms for Neurons From the Larval Fruit Fly Brain', 'Visualization and Exploration of 3D Toponome Data', 'A Critical Analysis of the Evaluation Practice in Medical Visualization', 'Visual and Quantitative Analysis of Higher Order Arborization Overlaps for Neural Circuit Research', 'Feature Exploration using Local Frequency Distributions in Computed Tomography Data', 'An Exploration of Practice and Preferences for the Visual Communication of Biomedical Processes', 'Fiber Stipples for Crossing Tracts in Probabilistic Tractography', 'Analyzing Protein Similarity by Clustering Molecular Surface Maps', 'A Web-Based Tool for Cardiac Dyssynchrony Assessment on Ultrasound Data', 'A General Approach to Model Biomedical Data from 3D Unorganised Point Clouds with Medial Scaffolds', 'Multiparametric Magnetic Resonance Image Synthesis using Generative Adversarial Networks', 'Geometrical-Acoustics-based Ultrasound Image Simulation', 'Automatic Real-time Annotation of Important Landmarks in Ultrasound-Guided Femoral Nerve Blocks', 'Visual Analysis of Regional Anomalies in Myocardial Motion', 'Combining B-Mode and Color Flow Vessel Segmentation for Registration of Hepatic CT and Ultrasound Volumes', 'Computation and Visualization of Asynchronous Behavior of the Heart', 'Real-Time Dense Nucleus Selection from Confocal Data', 'Simulation-based Ultrasound Training Supported by Annotations, Haptics and Linked Multimodal Views', 'CoWRadar: Visual Quantification of the Circle of Willis in Stroke Patients', 'Automated Slice-Based Artery Identification in Various Field-of-View CTA Scans', 'Shading Style Assessment for Vessel Wall and Lumen Visualization', 'HIFUtk: Visual Analytics for High Intensity Focused Ultrasound Simulation', 'Visual Assessment of Vascular Torsion using Ellipse Fitting', 'Generation of a Mean Motion Model of the Lung Using 4D-CT Image Data', 'Interactive Exploded Views for Molecular Structures', 'MedUse: A Visual Analysis Tool for Medication Use Data in the ABCD Study', 'Automatic Thrombus Detection in Non-enhanced Computed Tomography Images in Patients With Acute Ischemic Stroke', 'Illustrative Transitions in Molecular Visualization via Forward and Inverse Abstraction Transform', 'Interactive Labeling of Toponome Data', 'Strategies for Generating Multi-Time Frame Localization of Cardiac MRI', 'Tractography in Context: Multimodal Visualization of Probabilistic Tractograms in Anatomical Context', 'Computational Steering for Patient-Specific Implant Planning in Orthopedics', 'Introducing CNN-Based Mouse Grim Scale Analysis for Fully Automated Image-Based Assessment of Distress in Laboratory Mice', 'Glyph-Based Visualization of Myocardial Perfusion Data and Enhancement with Contractility and Viability Information', 'Interactive Visualization of Muscle Activity During Limb Movements: Towards Enhanced Anatomy Learning', 'The Vitruvian Baby: Interactive Reformation of Fetal Ultrasound Data to a T-Position', 'Medical Animations: A Survey and a Research Agenda', 'Ultrasound Decompression for Large Field-of-View Reconstructions', 'Haptics-based Modelling of Pigmented Skin Lesions', 'Visualizing White Matter Fiber Tracts with Optimally Fitted Curved Dissection Surfaces', 'Evaluation of Hippocampal Segmentation Methods for Healthy and Pathological Subjects', 'Visualisation of PET data in the Fly Algorithm', '2.5D Geometric Mapping of Aortic Blood Flow Data for Cohort Visualization', 'Exploration of 3D Medical Image Data for Interventional Radiology using Myoelectric Gesture Control', 'Imaging the Vascular Network of the Human Spleen from Immunostained Serial Sections', 'DockVis: Visual Analysis of Molecular Docking Data', 'Focus + Context Rendering of Structured Biomedical Data', 'VirtualDSA++: Automated Segmentation, Vessel Labeling, Occlusion Detection and Graph Search on CT-Angiography Data', 'How to Evaluate Medical Visualizations on the Example of 3D Aneurysm Surfaces', 'CT Late Enhancement Segmentation for the Combined Analysis of Coronary Arteries and Myocardial Viability', 'Ontology-Based Visualization of Hierarchical Neuroanatomical Structures', 'Instant Visualization of Secondary Structures of Molecular Models', 'Visual Analysis of Integrated Resting State Functional Brain Connectivity and Anatomy', 'Synaptic Connectivity in Anatomically Realistic Neural Networks: Modeling and Visual Analysis', 'Importance-Driven Structure Categorization for 3D Surgery Planning', 'Information-based Transfer Functions for Multimodal Visualization', 'Global and Local Mesh Morphing for Complex Biological Objects from ÂµCT Data', 'A Multilinear Model for Bidirectional Craniofacial Reconstruction', 'SWiFT Seeing the Wood From the Trees: helping people make sense of their health data', 'Real-Time Guidance and Anatomical Information by Image Projection onto Patients', 'Projection Mapping for In-Situ Surgery Planning by the Example of DIEP Flap Breast Reconstruction', 'preha: Establishing Precision Rehabilitation with Visual Analytics', 'Robust Cardiac Function Assessment in 4D PC-MRI Data', 'Progressive and Efficient Multi-Resolution Representations for Brain Tractograms', 'HIFUpm: a Visual Environment to Plan and Monitor High Intensity Focused Ultrasound Treatments', 'A Visual Analytics Approach for Patient Stratification and Biomarker Discovery', 'Interactive Visual Similarity Analysis of Measured and Simulated Multi-field Tubular Flow Ensembles', 'Interactive Classification of Multi-Shell Diffusion MRI With Features From a Dual-Branch CNN Autoencoder', 'A Visual Environment for Hypothesis Formation and Reasoning in Studies with fMRI and Multivariate Clinical Data', 'Vologram: An Educational Holographic Sculpture for Volumetric Medical Data Physicalization', 'Survey of Labeling Techniques in Medical Visualizations', 'Interactive Position-dependent Customization of Transfer Function Classification Parameters in Volume Rendering', 'Lowest-Variance Streamlines for Filtering of 3D Ultrasound', 'GPU Accelerated Normalized Mutual Information and B-Spline Transformation', 'RegistrationShop: An Interactive 3D Medical Volume Registration System', 'Visual Analysis of Bipartite Biological Networks', 'Efficient Globally Optimal Matching of Anatomical Trees of the Liver', 'Automatic Generation of Web-Based User Studies to Evaluate Depth Perception in Vascular Surface Visualizations', 'Parameterization and Feature Extraction for the Visualization of Tree-like Structures', 'Student and Teacher Meet in a Shared Virtual Reality: A one-on-one Tutoring System for Anatomy Education', 'Illustrated Ultrasound for Multimodal Data Interpretation of Liver Examinations', 'From Imprecise User Input to Precise Vessel Segmentations', 'Deriving Anatomical Context from 4D Ultrasound', 'Visual Analysis of Multivariate Intensive Care Surveillance Data', 'Distance Field Visualization and 2D Abstraction of Vessel Tree Structures with on-the-fly Parameterization', 'Hybrid Visualization of Protein-Lipid and Protein-Protein Interaction', 'A Comparative User Study of a 2D and an Autostereoscopic 3D Display for a Tympanoplastic Surgery', 'Visualizing and Exploring Dynamic Multichannel EEG Coherence Networks', 'Surface Curvature Line Clustering for Polyp Detection in CT Colonography', 'Concentric Circle Glyphs for Enhanced Depth-Judgment in Vascular Models', 'Robust Classification and Analysis of Anatomical Surfaces Using 3D Skeletons', 'A Survey on Visualizing Magnetic Resonance Spectroscopy Data', 'Anatomical Volume Visualization with Weighted Distance Fields', 'A Haptic Rendering Algorithm for Molecular Interaction', 'Semi-Automatic Vessel Boundary Detection in Cardiac 4D PC-MRI Data Using FTLE fields', 'Visualizing Movements of Protein Tunnels in Molecular Dynamics Simulations', 'Personalized X-ray Reconstruction of the Proximal Femur via a New Control Point-based 2D-3D Registration and Residual Complexity Minimization', 'Visual Analytics in Digital Pathology: Challenges and Opportunities', 'Automatic Hepatocyte Quantification from Histological Images: Comparing Pre-smoothing filters', 'Graph Averaging as a Means to Compare Multichannel EEG Coherence Networks', 'A New Vessel Enhancement Transform on Retinal Blood Vessels Segmentation', 'Learning Hand Anatomy with Sense of Embodiment', 'Interactive Formation of Statistical Hypotheses in Diffusion Tensor Imaging', 'Model-based Solid Texture Synthesis for Anatomic Volume Illustration', 'Sketch-based Image-independent Editing of 3D Tumor Segmentations using Variational Interpolation', 'GLANCE: Visual Analytics for Monitoring Glaucoma Progression', 'Constrained Labeling of 2D Slice Data for Reading Images in Radiology', 'A Framework for Fast Initial Exploration of PC-MRI Cardiac Flow', 'A Statistical Method for Surface Detection', 'On the Value of Multi-Volume Visualization for Preoperative Planning of Cerebral AVM Surgery', 'FoldSynth: Interactive 2D-3D Visualisation Platform for Molecular Strands', 'Dynamic Visualisation of Orbital Fat Deformation using Anatomy-Guided Interaction', 'Visual Navigation Support for Liver Applicator Placement using Interactive Map Displays', 'Image Registration Methods for Patient-Specific Virtual Physiological Human Models', 'FluoroSim: A Visual Problem-Solving Environment for Fluorescence Microscopy', 'Illustrative PET/CT Visualisation of SIRT-Treated Lung Metastases', 'BrainCove: A Tool for Voxel-wise fMRI Brain Connectivity Visualization', 'Visual Analytics of Missing Data in Epidemiological Cohort Studies', 'Interactive Real Time Simulation of Cardiac Radio-Frequency Ablation', 'SpectraMosaic: An Exploratory Tool for the Interactive Visual Analysis of Magnetic Resonance Spectroscopy Data', 'Fast and Smooth Interactive Segmentation of Medical Images Using Variational Interpolation', 'A Feasibility Study on Automated Protein Aggregate Characterization Utilizing a Hybrid Classification Model', 'UI-Net: Interactive Artificial Neural Networks for Iterative Image Segmentation Based on a User Model', 'InShaDe: Invariant Shape Descriptors for Visual Analysis of Histology 2D Cellular and Nuclear Shapes', 'Using Position-Based Dynamics for Simulating the Mitral Valve in a Decision Support System', 'Interactive CPU-based Ray Tracing of Solvent Excluded Surfaces', 'Semantic Screen-Space Occlusion for Multiscale Molecular Visualization', 'Feasibility Study For Automatic Bird Tracking and Visualization from Time-Dependent Marine Radar Imagery', 'MRI Hip Joint Segmentation: A Locally Bhattacharyya Weighted Hybrid 3D Level Set Approach', 'VRIDAA: Virtual Reality Platform for Training and Planning Implantations of Occluder Devices in Left Atrial Appendages', 'Visual Analysis of Medical Image Segmentation Feature Space for Interactive Supervised Classification', 'An Integrated Platform for Dynamic Cardiac Simulation and Image Processing: Application to Personalised Tetralogy of Fallot Simulation', 'Interactive Residual Stress Modeling for Soft Tissue Simulation', 'The Virtual Reality Flow Lens for Blood Flow Exploration', 'Robustness Evaluation of CFD Simulations to Mesh Deformation', 'Inlier Detection in Thermal Sensitive Images', 'Discovering Medical Knowledge Using Visual Analytics', 'A Guided Spatial Transformer Network for Histology Cell Differentiation', 'Application of Image Processing Functions for Brain Tumor Enhancement in Intraoperative Ultrasound Image Data', 'Improving Perception of Molecular Surface Visualizations by Incorporating Translucency Effects', 'Visual Analytics for the Exploration and Assessment of Segmentation Errors', 'Visual Assessment of Growth Prediction in Brain Structures after Pediatric Radiotherapy']
    # reading_embeddings(articles)

